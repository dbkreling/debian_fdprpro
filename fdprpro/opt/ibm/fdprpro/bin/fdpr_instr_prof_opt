#!/bin/sh
# performs FDPR instrumentation, profiling and optimization
# invocation: fdpr_instr_prof_opt <prog> <arg> ...
# environment:
# FDPR_BINDIR - directory containing fdprpro executable and scripts
# input:
# <prog> - input program
# <arg> ... - execution arguments
# output:
# <prog>.fdpr - filled profile
# returns:
# 0 - OK
# 1 - instrumentation failed
# 2 - profiling failed
# 3 - optimization failed
if [ "$FDPR_BINDIR" = "" ]; then FDPR_BINDIR=/opt/ibm/fdprpro/bin; fi
exec=$1
shift
args=$*

$FDPR_BINDIR/fdpr_instr "$exec" $args
if [ $? != 0 ]; then exit 1; fi

$FDPR_BINDIR/fdpr_prof "$exec" $args
if [ $? != 0 ]; then exit 2; fi

$FDPR_BINDIR/fdpr_opt "$exec" $args
if [ $? != 0 ]; then exit 3; fi
